%define name	metalog
%define version @VERSION@
%define release 1
%define prefix  /usr/local
%define builddir $RPM_BUILD_DIR/%{name}-%{version}

Name:		%{name}
Version:	%{version}
Release:	%{release}
Vendor:		Various
Packager:	Frank DENIS <j@pureftpd.org>
URL:		http://metalog.sourceforge.net
Source:     ftp://download.sourceforge.net/pub/sourceforge/metalog/%{name}-%{version}.tar.gz
Group:		System/Logging
Copyright:	GPL
#Requires:	
Provides:	syslog-daemon
BuildRoot:	/var/tmp/%{name}-%{version}
Summary:	An efficient alternative to syslogd
Obsoletes:  syslogd klogd
%description
Metalog is a modern replacement for syslogd and klogd. The logged messages
can be dispatched according to their facility, urgency, program name and/or
Perl-compatible regular expressions. Log files can be automatically rotated
when they exceed a certain size or age. External shell scripts (e.g., mail)
can be launched when specific patterns are found.
Metalog is easier to configure than syslogd and syslog-ng, accepts unlimited
number of rules and has (switchable) memory bufferization for maximal
performance.

%prep
%setup -n %{name}-%{version} 
#%patch -p1

%build
if [ ! -f configure ]; then
  CFLAGS="$RPM_OPT_FLAGS" ./autogen.sh --prefix=%{_prefix}
else
  CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{_prefix}
fi
if [ "$SMP" != "" ]; then
  (make "MAKE=make -k -j $SMP"; exit 0)
  make
else
  make
fi

%install
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf "$RPM_BUILD_ROOT"
make prefix=$RPM_BUILD_ROOT%{prefix} sysconfdir=$RPM_BUILD_ROOT%{sysconfdir} install

if [ ! -d $RPM_BUILD_ROOT%{prefix}/sbin ]; then
  mkdir -p $RPM_BUILD_ROOT%{prefix}/sbin
fi
if [ ! -d $RPM_BUILD_ROOT/etc ]; then
  mkdir -p $RPM_BUILD_ROOT/etc
fi
if [ ! -d $RPM_BUILD_ROOT%{prefix}/man/man8 ]; then
  mkdir -p $RPM_BUILD_ROOT%{prefix}/man/man8
fi

install -m 644 metalog.conf $RPM_BUILD_ROOT/etc/metalog.conf

%clean
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf "$RPM_BUILD_ROOT"

%files

%defattr(0755, root, root)
%{prefix}/sbin/metalog

%defattr(0644, root, root)
%{prefix}/man/man8/metalog.8

%doc README AUTHORS NEWS metalog.conf

%config /etc/metalog.conf

%changelog
* Mon Jul  9 2001 Frank DENIS <j@pureftpd.org>
- First RPM build of this package.
